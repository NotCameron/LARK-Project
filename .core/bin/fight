#!/bin/bash

monstName=$1

if [[ $1 != $(ls $PWD | grep -o $monstName 2>/dev/null) ]]; then
 echo "You can't fight that!"
 exit
elif [ $# -lt 1 ]; then
 echo "You can't fight nothing..."
 exit
elif [ $# -gt 1 ]; then
 echo "You can only fight one thing at a time!"
 exit
fi


printf "A $monstName approaches!\n"

echo "Your current inventory is: "
cat ~/LARK-Project/game/inventory
read -p "What weapon are you using? " wepName
read -p "What armor are you wearing? " armorName

source ~/LARK-Project/.core/modules/weapons/$wepName 2>/dev/null
source ~/LARK-Project/.core/modules/armor/$armorName 2>/dev/null
source ~/LARK-Project/.core/modules/monsters/$monstName 2>/dev/null
source ~/LARK-Project/.core/playerStats 2>/dev/null

trueMonstDam=$(($monstDam - $armorRate))
if [ $trueMonstDam -lt 1 ]; then
 trueMonstDam=1
fi

while [ $monstHP -gt 0 ] && [ $playerHP -gt 0 ]; do
 echo "Your current HP is: $playerHP"
 printf "What will you do? \n a) Attack   b) Use Potion   c) Run\n"
 read action
 case $action in
  a|A)
   source ~/LARK-Project/.core/modules/weapons/$wepName 2>/dev/null
   echo "You strike the monster with your $wepName for $wepDam damage!"
   monstHP=$(($monstHP - $wepDam))
   if [ $monstHP -gt 0 ]; then
    echo "$monstName strikes you for $monstDam resisted by $armorRate"
    playerHP=$(($playerHP - $trueMonstDam))
   fi
  ;;
  b|B)
   echo "You take a drink from a health potion and feel rejuvenated!"
   playerHP=10;
  ;;
  c|C)
   echo "You flee from the $monstName!"
   break
  ;;
  *)
   echo "Invalid Input!"
  ;;
 esac
done

if [ $playerHP -le 0 ]; then
  echo "You blackout!"
  cd ..
  echo "You wake up just outside the room you were in."
elif [ $monstHP -le 0 ]; then
  echo "You've slain the $monstName!"
  rm $monstName 2>/dev/null
fi
